<div th:fragment="chatPopupFragment">
<div id="chatPopup"
     style="position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.4); display:none; z-index:9999;">

    <div id="chatPopupContainer"
         style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%);
                width:90%; height:90%; background:white; border-radius:20px;
                overflow:hidden; box-shadow:0 20px 50px rgba(0,0,0,0.3);">

        <!-- هنا يتم تحميل صفحة الشات كاملة -->
        <iframe id="chatPopupIframe"
                src=""
                style="width:100%; height:100%; border:none;"></iframe>

    </div>
</div>

<script>
    function openChatPopup() {
        document.getElementById("chatPopup").style.display = "block";
        document.getElementById("chatPopupIframe").src = "/chat"; // ← صفحة الشات الأصلية
    }

    function closeChatPopup() {
        document.getElementById("chatPopup").style.display = "none";
        document.getElementById("chatPopupIframe").src = "";
    }

    // اغلاق عند الضغط خارج الـ popup
    document.addEventListener('click', function (e) {
        const popup = document.getElementById("chatPopupContainer");
        if (e.target === document.getElementById("chatPopup")) closeChatPopup();
    });
</script>
    <!-- نفس الكود السابق بتاع chat-popup -->
</div>
