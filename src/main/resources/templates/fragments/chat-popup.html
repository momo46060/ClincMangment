<div th:fragment="chatPopupFragment">

    <style>
        /*
         * ======================================
         * تخصيص الستايل للأزرق الطبي الفاخر (Medical Blue Chat Popup)
         * ======================================
         */

        /* الطبقة المعتمة (الشاشة الكاملة) */
        #chatPopup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* خلفية زرقاء داكنة شفافة بدلاً من الأسود */
            background: rgba(0, 86, 179, 0.35);
            display: none;
            z-index: 9999;
            backdrop-filter: blur(5px); /* إضافة تأثير تمويه خفيف للخلفية */
        }

        /* حاوية المحتوى (الإطار) */
        #chatPopupContainer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            height: 90%;
            background: white;
            /* حواف أكثر دائرية */
            border-radius: 25px;
            overflow: hidden;
            /* ظل أعمق وأفخم */
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.35);
            transition: transform 0.3s ease-out;
        }

        /* إطار الشات الداخلي */
        #chatPopupIframe {
            width: 100%;
            height: 100%;
            border: none;
            /* حواف دائرية ليتناسب مع الحاوية */
            border-radius: 20px;
        }

        /* تحسينات الاستجابة للهاتف */
        @media (max-width: 768px) {
            #chatPopupContainer {
                width: 98%;
                height: 98%;
                border-radius: 15px;
            }
            #chatPopupIframe {
                border-radius: 15px;
            }
        }
    </style>

    <div id="chatPopup">

        <div id="chatPopupContainer">

            <iframe id="chatPopupIframe" src=""></iframe>

        </div>
    </div>

    <script>
        function openChatPopup() {
            // إضافة فئة لتطبيق تأثير دخول (اختياري)
            const container = document.getElementById("chatPopupContainer");

            document.getElementById("chatPopup").style.display = "block";
            container.style.transform = "translate(-50%, -50%) scale(0.95)";

            // تأخير بسيط لإظهار الحركة
            setTimeout(() => {
                container.style.transform = "translate(-50%, -50%) scale(1)";
            }, 10);

            document.getElementById("chatPopupIframe").src = "/chat"; // ← صفحة الشات الأصلية
        }

        function closeChatPopup() {
            const container = document.getElementById("chatPopupContainer");

            // تطبيق تأثير خروج
            container.style.transform = "translate(-50%, -50%) scale(0.95)";

            setTimeout(() => {
                document.getElementById("chatPopup").style.display = "none";
                document.getElementById("chatPopupIframe").src = "";
                container.style.transform = "translate(-50%, -50%) scale(1)"; // إعادة التعيين
            }, 300); // 300ms يتناسب مع transition
        }

        // اغلاق عند الضغط خارج الـ popup
        document.addEventListener('click', function (e) {
            const popup = document.getElementById("chatPopup");
            if (e.target === popup) closeChatPopup();
        });
    </script>

</div>