<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ููุญุฉ ุงูููุฑุถุฉ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4 bg-light">

<div class="container">
    <h2 class="mb-4 text-center">ููุญุฉ ุงูููุฑุถุฉ</h2>
    <h5 class="text-muted">ุชุงุฑูุฎ ุงูููู: <span th:text="${today}"></span></h5>
    <!-- ุฑุณุงุฆู ุงูุชูุจูู -->
    <div class="container mt-3">
        <div th:if="${success}" class="alert alert-success text-center" th:text="${success}"></div>
        <div th:if="${error}" class="alert alert-danger text-center" th:text="${error}"></div>
    </div>
    <div class="card mt-4 shadow">
        <div class="card-header bg-success text-white">
            <strong>ุญุฌูุฒุงุช ุงูููู</strong>
        </div>
        <div class="mb-3">
            <form th:action="@{/nurse/dashboard}" method="get" class="d-flex justify-content-start">
                <label for="doctor" class="me-2 align-self-center">ููุชุฑ ุญุณุจ ุงูุฏูุชูุฑ:</label>
                <select name="doctorId" id="doctor" class="form-select w-auto me-2">
                    <option value="">ุงููู</option>
                    <option th:each="d : ${doctors}"
                            th:value="${d.id}"
                            th:text="${d.fullName}"
                            th:selected="${d.id == selectedDoctorId}"></option>
                </select>
                <button type="submit" class="btn btn-success btn-sm">ุชุทุจูู</button>
            </form>
        </div>

        <div class="card-body">
            <table class="table table-striped table-hover align-middle">
                <thead class="table-success">
                <tr>
                    <th>ุงูููุฏ</th>
                    <th>ุงุณู ุงููุฑูุถ</th>
                    <th>ููุน ุงูุฒูุงุฑุฉ</th>
                    <th>ุงูุฏูุชูุฑ</th>
                    <th>ุงูููุช</th>
                    <th>ุงูุญุงูุฉ</th>
                    <th>ุงูุฅุฌุฑุงุกุงุช</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="v : ${todayVisits}">
                    <td th:text="${v.patient.patientCode}"></td>
                    <td th:text="${v.patient.user.fullName}"></td>
                    <td th:text="${v.visitType}"></td>
                    <td th:text="${v.doctor != null ? v.doctor.fullName : '---'}"></td>
                    <td th:text="${#temporals.format(v.visitDate, 'yyyy-MM-dd HH:mm')}"></td>
                    <td th:text="${v.status}"></td>
                    <td>
                        <!-- ุชุบููุฑ ุงูุญุงูุฉ -->
                        <form th:action="@{'/nurse/visit/' + ${v.id} + '/status'}" method="post" class="d-inline">
                            <select name="status" class="form-select form-select-sm d-inline w-auto" onchange="this.form.submit()">
                                <option value="ูู ุงูุงูุชุธุงุฑ" th:selected="${v.status == 'ูู ุงูุงูุชุธุงุฑ'}">ูู ุงูุงูุชุธุงุฑ</option>
                                <option value="ุฌุงุฑู ุงููุดู" th:selected="${v.status == 'ุฌุงุฑู ุงููุดู'}">ุฌุงุฑู ุงููุดู</option>
                                <option value="ุชู ุงููุดู" th:selected="${v.status == 'ุชู ุงููุดู'}">ุชู ุงููุดู</option>
                            </select>
                        </form>

                        <!-- ุฅูุบุงุก ุงูุฒูุงุฑุฉ -->
                        <form th:action="@{'/nurse/visit/' + ${v.id} + '/cancel'}" method="post" class="d-inline"
                              onsubmit="return confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุฅูุบุงุก ูุฐู ุงูุฒูุงุฑุฉุ');">
                            <button type="submit" class="btn btn-danger btn-sm ms-1">ุฅูุบุงุก</button>
                        </form>
                    </td>
                </tr>

                <tr th:if="${#lists.isEmpty(todayVisits)}">
                    <td colspan="7" class="text-center text-muted">ูุง ุชูุฌุฏ ุญุฌูุฒุงุช ุงูููู</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="mt-4 text-center">
        <a href="/patients/search" class="btn btn-primary">๐ ุญุฌุฒ ูุดู ุฌุฏูุฏ</a>
        <a href="/logout" class="btn btn-danger">ุชุณุฌูู ุงูุฎุฑูุฌ</a>
    </div>
</div>

</body>
</html>
